<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Ingestion - Jobs</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Global Box Sizing */
      * {
        box-sizing: border-box;
      }
      /* Global Styles */
      body {
        margin: 0;
        padding: 20px;
        font-family: "Roboto", sans-serif;
        background: linear-gradient(135deg, #60c3ca, #9bd9d7);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      /* Container styling */
      .container {
        background: #ffffff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        width: 90%;
        max-width: 800px;
      }
      /* Header Area */
      #header-area {
        margin-bottom: 20px;
        text-align: center;
      }
      #header-area h2 {
        margin: 0;
        color: #333333;
      }
      /* Back button in header */
      #back-to-list {
        padding: 12px;
        background-color: black;
        color: #ffffff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-bottom: 10px;
        display: none;
      }
      #back-to-list:hover {
        background-color: #333;
      }
      /* Job List Styling */
      .job-list {
        list-style: none;
        padding: 0;
      }
      .job-item {
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        background: #ffffff;
        transition: background-color 0.3s ease;
      }
      .job-item:hover {
        background-color: #f9f9f9;
      }
      .job-status {
        font-weight: bold;
        color: #4caf50;
      }
      .hidden {
        display: none;
      }
      /* Button Styling */
      button {
        padding: 12px;
        background-color: #4caf50;
        color: #ffffff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-top: 10px;
      }
      button:hover {
        background-color: #45a049;
      }
      .close-btn {
        background-color: #f44336;
        margin-left: 10px;
      }
      /* New Project Button Styling */
      .new-project-btn {
        background-color: #2196f3;
        margin-top: 10px;
      }
      .new-project-btn:hover {
        background-color: #1976d2;
      }
      .modal-buttons {
        margin-top: 15px;
      }
      /* Form Elements */
      input[type="text"] {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
      }
      /* Modal Styling */
      .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        text-align: center;
      }
      /* Project Options as Checkboxes */
      #project-options {
        text-align: left;
        margin: 15px 0;
      }
      #project-options label {
        display: block;
        margin-bottom: 8px;
        cursor: pointer;
      }
      /* Drag and Drop Boxes Styling */
      #drag-drop-section {
        display: flex;
        gap: 20px;
        margin-top: 20px;
      }
      .drag-box {
        flex: 1;
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 10px;
        min-height: 200px;
        background-color: #f9f9f9;
      }
      .drag-box h4 {
        text-align: center;
        margin-top: 0;
      }
      .drag-list {
        list-style: none;
        padding: 0;
        margin: 0;
        min-height: 150px;
      }
      .drag-list li {
        padding: 8px;
        margin: 5px;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: grab;
      }
      .drag-over {
        background-color: #e0f7fa;
      }
      /* Decision Buttons */
      #decision-buttons {
        margin-top: 20px;
        text-align: center;
      }
      #decision-buttons button {
        margin: 0 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="header-area">
        <button id="back-to-list">Back to Job List</button>
        <h2 id="job-list-header">Your Jobs</h2>
      </div>
      <ul id="job-list" class="job-list"></ul>

      <div id="job-detail" class="hidden">
        <h3>Job Detail</h3>
        <p>
          <strong>Job ID:</strong>
          <span id="detail-job-id"></span>
        </p>
        <p>
          <strong>Status:</strong>
          <span id="detail-job-status" class="job-status"></span>
        </p>

        <!-- Drag and Drop Section (Reordered) -->
        <div id="drag-drop-section" class="hidden">
          <div class="drag-box" data-status="confirmed">
            <h4>Confirmed</h4>
            <ul class="drag-list" id="confirmed-list"></ul>
          </div>
          <div class="drag-box" data-status="rejected">
            <h4>Rejected</h4>
            <ul class="drag-list" id="rejected-list"></ul>
          </div>
          <div class="drag-box" data-status="needs-confirmation">
            <h4>Needs Confirmation</h4>
            <ul class="drag-list" id="needs-confirmation-list"></ul>
          </div>
        </div>

        <!-- Accept & Reject Buttons -->
        <div id="decision-buttons" class="hidden">
          <button id="accept-btn">Accept Prediction</button>
          <button id="reject-btn" class="close-btn">Reject Prediction</button>
        </div>
      </div>
    </div>

    <!-- Project Selection Modal -->
    <div id="project-modal" class="modal">
      <div class="modal-content">
        <h3>Project Storage</h3>
        <p>Select one of the options below:</p>
        <div id="existing-projects">
          <p><strong>Existing Projects</strong></p>
          <div id="project-options">
            <label>
              <input type="checkbox" name="project" value="Project A" />
              Project A
            </label>
            <label>
              <input type="checkbox" name="project" value="Project B" />
              Project B
            </label>
          </div>
        </div>
        <hr />
        <div id="new-project-section">
          <p><strong>Or Create a New Project</strong></p>
          <button id="create-new-project-btn" class="new-project-btn">
            Create New Project
          </button>
          <input
            type="text"
            id="new-project-name"
            placeholder="Enter new project name"
            class="hidden"
          />
        </div>
        <div class="modal-buttons">
          <button id="submit-project">Submit</button>
          <button id="close-project-modal" class="close-btn">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      let jobs = [
        {
          id: "ID:12345",
          metadata: { classification: "HR" },
          status: "Processed",
          predictionItems: [
            "Classified as HR document",
            "Reviewed by system",
            "Needs manual confirmation",
          ],
        },
      ];
      let selectedJob = null;
      let draggedItem = null;

      // projectMode can be "existing" or "new"
      let projectMode = "existing";

      function updateJobList() {
        const jobList = document.getElementById("job-list");
        jobList.innerHTML = "";
        jobs.forEach((job) => {
          let li = document.createElement("li");
          li.className = "job-item";
          li.dataset.jobId = job.id;
          li.innerHTML = `<span><strong>${job.id}</strong> - ${job.metadata.classification}</span>
                            <span class="job-status">${job.status}</span>`;
          li.addEventListener("click", () => showJobDetail(job.id));
          jobList.appendChild(li);
        });
      }

      function showJobDetail(jobId) {
        selectedJob = jobs.find((j) => j.id === jobId);
        if (!selectedJob) return;

        document.getElementById("job-list-header").style.display = "none";
        document.getElementById("back-to-list").style.display = "block";

        document.getElementById("detail-job-id").textContent = selectedJob.id;
        document.getElementById("detail-job-status").textContent =
          selectedJob.status;

        const dragSection = document.getElementById("drag-drop-section");
        const decisionButtons = document.getElementById("decision-buttons");
        if (selectedJob.status === "Processed" && selectedJob.predictionItems) {
          document.getElementById("confirmed-list").innerHTML = "";
          document.getElementById("rejected-list").innerHTML = "";
          document.getElementById("needs-confirmation-list").innerHTML = "";
          selectedJob.predictionItems.forEach((itemText) => {
            const li = document.createElement("li");
            li.textContent = itemText;
            li.setAttribute("draggable", "true");
            li.addEventListener("dragstart", dragStart);
            li.addEventListener("dragend", dragEnd);
            document.getElementById("needs-confirmation-list").appendChild(li);
          });
          dragSection.classList.remove("hidden");
          decisionButtons.classList.remove("hidden");
        } else {
          dragSection.classList.add("hidden");
          decisionButtons.classList.add("hidden");
        }
        document.getElementById("job-detail").classList.remove("hidden");
        document.getElementById("job-list").style.display = "none";
      }

      document.getElementById("back-to-list").addEventListener("click", () => {
        document.getElementById("back-to-list").style.display = "none";
        document.getElementById("job-list-header").style.display = "block";
        document.getElementById("job-detail").classList.add("hidden");
        document.getElementById("job-list").style.display = "block";
      });

      function dragStart(e) {
        draggedItem = this;
        setTimeout(() => {
          this.style.display = "none";
        }, 0);
      }

      function dragEnd(e) {
        this.style.display = "block";
        draggedItem = null;
      }

      function dragOver(e) {
        e.preventDefault();
        this.classList.add("drag-over");
      }

      function dragLeave(e) {
        this.classList.remove("drag-over");
      }

      function drop(e) {
        e.preventDefault();
        this.classList.remove("drag-over");
        if (draggedItem) {
          this.querySelector("ul").appendChild(draggedItem);
        }
      }

      const dragBoxes = document.querySelectorAll(".drag-box");
      dragBoxes.forEach((box) => {
        box.addEventListener("dragover", dragOver);
        box.addEventListener("dragleave", dragLeave);
        box.addEventListener("drop", drop);
      });

      document.getElementById("reject-btn").addEventListener("click", () => {
        selectedJob.status = "Rejected";
        updateJobList();
        alert("Prediction Rejected.");
        document.getElementById("back-to-list").style.display = "none";
        document.getElementById("job-list-header").style.display = "block";
        document.getElementById("job-detail").classList.add("hidden");
        document.getElementById("job-list").style.display = "block";
      });

      document.getElementById("accept-btn").addEventListener("click", () => {
        // Reset to default mode on open.
        projectMode = "existing";
        document.getElementById("new-project-name").classList.add("hidden");
        // Ensure existing project checkboxes are enabled.
        document.querySelectorAll('input[name="project"]').forEach((chk) => {
          chk.disabled = false;
          chk.checked = false;
        });
        // Reset new project button text.
        document.getElementById("create-new-project-btn").textContent =
          "Create New Project";
        document.getElementById("project-modal").style.display = "flex";
      });

      document
        .getElementById("close-project-modal")
        .addEventListener("click", () => {
          document.getElementById("project-modal").style.display = "none";
        });

      // Toggle between existing projects and new project mode.
      document
        .getElementById("create-new-project-btn")
        .addEventListener("click", function () {
          const newProjectInput = document.getElementById("new-project-name");
          if (projectMode === "existing") {
            // Switch to new project mode:
            projectMode = "new";
            newProjectInput.classList.remove("hidden");
            // Disable existing project checkboxes.
            document
              .querySelectorAll('input[name="project"]')
              .forEach((chk) => {
                chk.checked = false;
                chk.disabled = true;
              });
            this.textContent = "Use Existing Projects";
          } else {
            // Switch back to existing projects mode:
            projectMode = "existing";
            newProjectInput.classList.add("hidden");
            newProjectInput.value = "";
            // Re-enable checkboxes.
            document
              .querySelectorAll('input[name="project"]')
              .forEach((chk) => {
                chk.disabled = false;
              });
            this.textContent = "Create New Project";
          }
        });

      document
        .getElementById("submit-project")
        .addEventListener("click", function () {
          let selectedValues = [];
          if (projectMode === "existing") {
            const checkedBoxes = document.querySelectorAll(
              'input[name="project"]:checked'
            );
            selectedValues = Array.from(checkedBoxes).map((box) => box.value);
          } else if (projectMode === "new") {
            const newProjectInput = document.getElementById("new-project-name");
            if (newProjectInput.value.trim() !== "") {
              selectedValues = [newProjectInput.value.trim()];
            }
          }
          if (selectedValues.length === 0) {
            alert("Please select at least one project or create a new one.");
            return;
          }
          selectedJob.status = "Accepted to " + selectedValues.join(", ");
          updateJobList();
          alert("Document linked to " + selectedValues.join(", "));
          document.getElementById("project-modal").style.display = "none";
          document.getElementById("back-to-list").style.display = "none";
          document.getElementById("job-list-header").style.display = "block";
          document.getElementById("job-detail").classList.add("hidden");
          document.getElementById("job-list").style.display = "block";
        });

      updateJobList();
    </script>
  </body>
</html>
